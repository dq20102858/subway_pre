webpackJsonp([10],{

/***/ "TJN0":
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__("FZ+f")(false);
// imports


// module
exports.push([module.i, "\n.sttitle {\r\n  color: #fff;\r\n  padding: 22px 0 0 25px;\r\n  font-size: 24px;\n}\n#progress {\r\n  background: #081c33;\r\n  height: 100vh;\n}\n.station {\r\n  margin: 100px 100px 0px 100px;\n}\n.linebar {\r\n  overflow: hidden;\n}\n.linebar .title {\r\n  margin-left: 102px;\r\n  color: #fff;\r\n  font-weight: 700;\r\n  color: #fff;\n}\n.linebar .bar {\r\n  margin-bottom: 10px;\n}\n.linebar .bar span {\r\n  width: 96px;\r\n  font-size: 12px;\r\n  text-align: right;\r\n  color: #fff;\r\n  display: inline-block;\n}\n.linebar .bar em {\r\n  border: 1px #27db07 solid;\r\n  height: 10px;\r\n  display: inline-block;\r\n  position: relative;\n}\n.linebar .bar em i {\r\n  position: absolute;\r\n  top: 0;\r\n  background: #27db07;\r\n  height: 8px;\r\n  display: inline-block;\n}\r\n/* //#27DB07 */\r\n", ""]);

// exports


/***/ }),

/***/ "ayIP":
/***/ (function(module, exports, __webpack_require__) {

// style-loader: Adds some css to the DOM by adding a <style> tag

// load the styles
var content = __webpack_require__("TJN0");
if(typeof content === 'string') content = [[module.i, content, '']];
if(content.locals) module.exports = content.locals;
// add the styles to the DOM
var update = __webpack_require__("rjj0")("e5d9f972", content, true);

/***/ }),

/***/ "mC5q":
/***/ (function(module, exports) {

module.exports = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAB4CAYAAAD2SgIRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF7WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDggNzkuMTY0MDM2LCAyMDE5LzA4LzEzLTAxOjA2OjU3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUuNSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTA5VDEzOjM1OjU1KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0wOVQxMzo0MTowNCswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMC0wMy0wOVQxMzo0MTowNCswODowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3MmU0NDMyNi05MWZmLWIyNGYtYjBlNC1kMmQ4NDU1ZGM3ZjYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzFDNDIyOTVGQzIxMTFFNzgyMTFDQzIwRTFCNkNBQjIiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpDMUM0MjI5NUZDMjExMUU3ODIxMUNDMjBFMUI2Q0FCMiIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMxQzQyMjkyRkMyMTExRTc4MjExQ0MyMEUxQjZDQUIyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMxQzQyMjkzRkMyMTExRTc4MjExQ0MyMEUxQjZDQUIyIi8+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyZTQ0MzI2LTkxZmYtYjI0Zi1iMGU0LWQyZDg0NTVkYzdmNiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0wOVQxMzo0MTowNCswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrFLz64AAAJLSURBVGiB7dlPiIxxGAfwz7wrrfdg13vAYXv9aXMSSlJOnFBckHLjLMXFwdXBwWEPTpzJxa6EuDlsuTmwCiWZSRG740+7i02tw/sO7/7M2DFJqd+3pul95nk+M/POvM8cplafmtEhK3AEe7EJqzGHV3iOO7iaZ+n7dsO1NnA/TuE0Bjs9a5kPOI+RPEs//w5ei5vYuAgY5jH251n6slVIKg8OYbwHVDkz3mjODoVwP8ZKvJpJnFGc4/7ytqmsTQa9QxhrNGeXVeGT2BY0jmEY5zCBr+VtoqwNYzSY2VZaavWpmQwvMFBpuI6DmG/7xn+mhms4UKl9xPpE8ZWqopM42gWq7DmGd5XaAI4k2B00X8CnLlCQZ+knjATlPQm2BMUb3aKV3AqONydYFRSf9gA/C45XJYoPoJq+HuAlwfG3BG+C4oYe4HDmdYKHQXFfD3A48yRRbKlqjlt8+fxIozk7UM5UczfBFcWWamU1LuruXPfhUjnTygdcThRXSvg9PIyrFl44YZaXPYeD+kiepR9ba3Mp7mNr0PRWccHcVuwIik22DyewMuh/gB15ls5V9/Ea3MO6Dq/wS3nf3+Hxl9iZZ2mdhfu4jl141GGwtTbbZaKKhnAL346zmO6AVDNd9m6vorT/zWtlEIewR7FCqxnFXYz+yY9pu4Qr9McayLO07UB4Kv5aIhzhCEc4whGOcIQjHOEIRzjCEY5whCMc4QhHOMIR/qdwbX5+8T8aG83ZBU15lob/qP2S/+9URDjCEY5whCMc4QhH+P+BvwN7e4CFmUzVxQAAAABJRU5ErkJggg=="

/***/ }),

/***/ "naN1":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });

// EXTERNAL MODULE: ./node_modules/babel-runtime/core-js/json/stringify.js
var stringify = __webpack_require__("mvHQ");
var stringify_default = /*#__PURE__*/__webpack_require__.n(stringify);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/views/progress/index.vue

//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

/* harmony default export */ var progress = ({
  data: function data() {
    return {
      cwidth: 0,
      stationList: [],
      lineTypeList: [],
      listSchedule: [],
      minMileage: 0,
      every: 0
    };
  },
  created: function created() {
    this.getProjectProcessMap();
  },

  methods: {
    getProjectProcessMap: function getProjectProcessMap() {
      var _this = this;

      this.request({
        url: "/project/projectProcessMap",
        method: "get"
      }).then(function (response) {
        var data = response.data;
        if (data.status == 1) {
          _this.stationList = data.data.stations;
          _this.lineTypeList = data.data.line_types;
          _this.listSchedule = data.data.datas;
          _this.getStationList();
          //  this.getLineType();
        }
      });
    },
    getStationList: function getStationList() {
      var clientWidth = this.$refs.proWrapper.clientWidth;
      var canvasWidth = clientWidth - 200;
      this.cwidth = canvasWidth;
      console.log("canvasWidth：" + canvasWidth);
      var canvas = this.$refs.canvasStation;
      var cansText = canvas.getContext("2d");
      canvas.width = canvasWidth;

      cansText.moveTo(0, 250);
      cansText.lineTo(canvasWidth, 250);
      cansText.strokeStyle = "#B4D3E5";
      cansText.lineWidth = 10;
      cansText.stroke();
      cansText.moveTo(0, 300);
      cansText.lineTo(canvasWidth, 300);
      cansText.stroke();
      //起终点里程
      // cansText.lineWidth = 3;
      // cansText.moveTo(0, 245);
      // cansText.lineTo(0, 380);
      // cansText.stroke();
      //Station=====================Station
      var json = this.stationList;
      //console.log(JSON.stringify(json))
      //找到最大数与最小数
      var first = json[0];
      var end = json[0];
      for (var i = 1; i < json.length; i++) {
        var tmp = json[i];
        if (first.start_flag > tmp.start_flag) first = tmp;
        if (end.start_flag < tmp.start_flag) end = tmp;
      }

      // 总里程（最大数 - 最小数)
      var mileage = (end.start_flag - first.start_flag) * 1000 + end.start_length - first.start_length;
      console.log("总里程mileage：" + mileage);
      this.minMileage = first.start_flag * 1000 + first.start_length; //最小里程
      console.log("最小里程minMileage：" + this.minMileage);
      //每米长度等于px
      var every = (parseInt(canvasWidth - 30) / mileage).toFixed(5);
      this.every = every;
      console.log("每米长度every：" + every);
      //
      var img = new Image();
      img.src = __webpack_require__("mC5q");
      img.onload = function () {
        var start = 0;
        for (var _i = 0; _i < json.length; _i++) {
          // 绘制站点图
          var total = parseInt(json[_i].start_flag) * 1000 + parseInt(json[_i].start_length);
          //console.log("total：" + total);
          // 计算当前站点的x轴
          var startX = total * every;
          // 粗线向右移动了100像素，所以需要修正x轴
          if (_i == 0) start = startX; //从左侧126像素开始绘制
          //console.log("startX：" + parseInt(startX - start) );
          cansText.drawImage(img, startX - start, 126, 22, 120);
          //站名
          cansText.font = "16px Microsoft Yahei";
          cansText.fillStyle = "#0AE39A";
          var origin = json[_i].name.split("");
          for (var x = 0; x < origin.length; x++) {
            cansText.fillText(origin[x], startX - start + 2, 138 - origin.length * 19 + 19 * x);
          }
          //DK
          var codes = "DK" + json[_i].start_flag + " +" + json[_i].start_length;
          cansText.fillStyle = "#fff";
          cansText.font = "12px  Microsoft Yahei";
          cansText.fillTextVertical(codes, startX - start + 20, 165);
        }
      };

      //Line=====================line
      var lineJson = this.lineTypeList;
      console.log("lineJson:" + stringify_default()(lineJson));
      var lineData = [];
      for (var _i2 = 0; _i2 < lineJson.length; _i2++) {
        if (lineJson[_i2].name == "左线" || lineJson[_i2].name == "右线") {
          lineData.push(lineJson[_i2]);
        }
      }

      var from0 = "DK" + lineData[0].start_flag + "+" + lineData[0].start_length,
          end0 = "DK" + lineData[0].end_flag + "+" + lineData[0].end_length,
          from1 = "DK" + lineData[1].start_flag + "+" + lineData[1].start_length,
          end1 = "DK" + lineData[1].end_flag + "+" + lineData[1].end_length,
          name0 = lineData[0].name,
          name1 = lineData[1].name;

      console.log(lineData);

      var startLength = cansText.measureText(from0).width,
          endLength = cansText.measureText(end0).width,
          n0Length = cansText.measureText(name0).width,
          n1Length = cansText.measureText(name1).width;

      cansText.font = "12px Microsoft Yahei";
      cansText.fillStyle = "#E8C640";

      cansText.fillText(from0, 50, 270);
      cansText.fillText(name0, 5, 270);
      cansText.fillText(end0, parseInt(endLength + canvasWidth - 120), 320);
      cansText.fillText(from1, 50, 320);
      cansText.fillText(name1, 5, 320);
      cansText.fillText(end1, parseInt(endLength + canvasWidth - 120), 270);
      //Line=====================workline

      // let datas = [
      //   {
      //     name: "焊接1",
      //     lines: [
      //       {
      //         name: "左线1",
      //         lists: [
      //           {
      //             start_flag: "21",
      //             start_length: "370",
      //             end_flag: "22",
      //             end_length: "520"
      //           },
      //           {
      //             start_flag: "23",
      //             start_length: "300",
      //             end_flag: "23",
      //             end_length: "500"
      //           }
      //         ]
      //       },
      //       {
      //         name: "右线1",
      //         lists: [
      //           {
      //             start_flag: "30",
      //             start_length: "100",
      //             end_flag: "30",
      //             end_length: "500"
      //           },
      //           {
      //             start_flag: "33",
      //             start_length: "20",
      //             end_flag: "33",
      //             end_length: "400"
      //           }
      //         ]
      //       }
      //     ]
      //   }
      // ];

      // this.listSchedule = datas;

      //
    },

    lineFill: function lineFill(paras) {
      var result = "";
      var start = 0;
      for (var i = 0; i < paras.length; i++) {
        var starMileage = parseInt(paras[i].start_flag) * 1000 + parseInt(paras[i].start_length);
        var endMileage = parseInt(paras[i].end_flag) * 1000 + parseInt(paras[i].end_length);
        var leftPosition = parseInt(starMileage - this.minMileage) * this.every + 10;
        var widthPosition = parseInt(endMileage - starMileage) * this.every;
        // console.log("starNum:" + starMileage + " endNum:" + endMileage);
        // console.log(
        //   "leftPosition:" + leftPosition + " widthPosition:" + widthPosition
        // );
        result += "<i style='width:" + widthPosition + "px;left:" + leftPosition + "px'>";
      }
      return result;
    }
  },
  mounted: function mounted() {
    window.addEventListener("resize", this.getProjectProcessMap);
  },
  destroyed: function destroyed() {
    window.removeEventListener("resize", this.getProjectProcessMap);
  }
});

//prototype
CanvasRenderingContext2D.prototype.fillTextVertical = function (text, x, y) {
  var context = this;
  var canvas = context.canvas;

  var arrText = text.split("");
  var arrWidth = arrText.map(function (letter) {
    return context.measureText(letter).width;
  });

  var align = context.textAlign;
  var baseline = context.textBaseline;

  if (align == "left") {
    x = x + Math.max.apply(null, arrWidth) / 2;
  } else if (align == "right") {
    x = x - Math.max.apply(null, arrWidth) / 2;
  }
  if (baseline == "bottom" || baseline == "alphabetic" || baseline == "ideographic") {
    y = y - arrWidth[0] / 2;
  } else if (baseline == "top" || baseline == "hanging") {
    y = y + arrWidth[0] / 2;
  }

  context.textAlign = "center";
  context.textBaseline = "middle";

  // 开始逐字绘制
  arrText.forEach(function (letter, index) {
    // 确定下一个字符的纵坐标位置
    var letterWidth = arrWidth[index];
    // 是否需要旋转判断
    var code = letter.charCodeAt(0);
    if (code <= 256) {
      context.translate(x, y);
      // 英文字符，旋转90°
      context.rotate(90 * Math.PI / 180);
      context.translate(-x, -y);
    } else if (index > 0 && text.charCodeAt(index - 1) < 256) {
      // y修正
      y = y + arrWidth[index - 1] / 2;
    }
    context.fillText(letter, x, y);
    // 旋转坐标系还原成初始态
    context.setTransform(1, 0, 0, 1, 0, 0);
    // 确定下一个字符的纵坐标位置
    var letterWidth = arrWidth[index];
    y = y + letterWidth;
  });
  // 水平垂直对齐方式还原
  context.textAlign = align;
  context.textBaseline = baseline;
};
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-24c1ccf6","hasScoped":false,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/progress/index.vue
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:"proWrapper",attrs:{"id":"progress"}},[_c('div',{staticClass:"sttitle"},[_vm._v("施工形象进度图")]),_vm._v(" "),_c('div',{staticClass:"station"},[_c('canvas',{ref:"canvasStation",attrs:{"id":"canvasStation","height":"380"}},[_c('p',[_vm._v("您的系统不支持此程序!")])])]),_vm._v(" "),_vm._l((_vm.listSchedule),function(item){return _c('div',{key:item.id,staticClass:"linebar"},[_c('div',{staticClass:"title"},[_vm._v(_vm._s(item.name))]),_vm._v(" "),_vm._l((item.lines),function(lines){return _c('div',{key:lines.id,staticClass:"bar"},[_c('span',[_vm._v(_vm._s(lines.name))]),_vm._v(" "),_c('em',{style:({width: _vm.cwidth + 'px' }),domProps:{"innerHTML":_vm._s(_vm.lineFill(lines.lists))}})])})],2)})],2)}
var staticRenderFns = []
var esExports = { render: render, staticRenderFns: staticRenderFns }
/* harmony default export */ var views_progress = (esExports);
// CONCATENATED MODULE: ./src/views/progress/index.vue
function injectStyle (ssrContext) {
  __webpack_require__("ayIP")
}
var normalizeComponent = __webpack_require__("VU/8")
/* script */

/* template */

/* template functional */
var __vue_template_functional__ = false
/* styles */
var __vue_styles__ = injectStyle
/* scopeId */
var __vue_scopeId__ = null
/* moduleIdentifier (server only) */
var __vue_module_identifier__ = null
var Component = normalizeComponent(
  progress,
  views_progress,
  __vue_template_functional__,
  __vue_styles__,
  __vue_scopeId__,
  __vue_module_identifier__
)

/* harmony default export */ var src_views_progress = __webpack_exports__["default"] = (Component.exports);


/***/ })

});