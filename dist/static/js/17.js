webpackJsonp([17],{

/***/ "0QOC":
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__("FZ+f")(false);
// imports


// module
exports.push([module.i, "\n.security-title {\r\n  background: #3655a5;\r\n  color: #fff;\r\n  border-bottom: none !important;\r\n  font-size: 18px;\r\n  border-radius: 6px 6px 0 0;\r\n  padding: 12px 0;\r\n  text-align: center;\n}\n#security .formbox {\r\n  padding: 0 10px;\n}\n#security .el-textarea {\r\n  width: 100%;\n}\n#security .el-textarea__inner {\r\n  height: 140px;\n}\n#security .textarea1 .el-textarea__inner {\r\n  height: 80px;\n}\n#security .el-form-item-inline .el-input--medium {\r\n  display: inline-block;\r\n  width: 80px;\r\n  text-align: center;\n}\n#security .el-form-item-inline input {\r\n  display: inline-block;\r\n  width: 80px;\r\n  text-align: center;\n}\n#security .listpagedetail {\r\n  margin-top: 20px;\r\n  margin-bottom: 20px;\n}\n#security .listpagedetail .app-page-container {\r\n  min-height: 300px;\n}\n#security .listpagedetail .detailleft {\r\n  float: left;\r\n  width: 49.2%;\n}\n#security .listpagedetail .detailright {\r\n  float: right;\r\n  width: 49.2%;\r\n  height: 400px;\n}\n.steps-info {\r\n  line-height: 28px;\n}\n.steps-info .imgs {\r\n  width: 100%;\r\n  overflow: hidden;\r\n  display: block;\n}\n.steps-info .imgs img {\r\n  width: 148px;\r\n  height: 148px;\r\n  margin-right: 10px;\r\n  border-radius: 6px;\r\n  border: 1px #f9f9f9 solid;\n}\n.steps-info .imgs .el-image__inner--center {\r\n  left: 0;\r\n  top: 0;\r\n  -webkit-transform: translate(0%, 0%);\r\n          transform: translate(0%, 0%);\n}\n.steps-info .el-icon-circle-close {\r\n  color: #fff;\n}\n.steps-section {\r\n  overflow-x: auto;\n}\n.timeline {\r\n  width: 100%;\r\n  height: auto;\r\n  padding-bottom: 10px;\r\n  font-size: 0;\r\n  white-space: nowrap;\n}\n.timeline li {\r\n  text-align: center;\r\n  position: relative;\r\n  display: inline-block;\r\n  *display: inline;\r\n  zoom: 1;\r\n  width: auto;\r\n  font-size: 16px;\r\n  padding: 20px;\n}\n.timeline li .time {\r\n  padding-top: 10px;\r\n  color: #333;\r\n  font-weight: 400;\n}\n.timeline li .time p {\r\n  line-height: 31px;\n}\n.timeline li .time:before {\r\n  content: \"\";\r\n  display: block;\r\n  position: absolute;\r\n  width: 28px;\r\n  height: 28px;\r\n  top: 50px;\r\n  margin-bottom: -4px;\r\n  left: 50%;\r\n  margin-left: -15px;\r\n  border: 5px #898989 solid;\r\n  background: #fff;\r\n  border-radius: 100%;\r\n  background-size: 10px 10px;\r\n  z-index: 100;\n}\n.timeline li .time:after {\r\n  content: \"\";\r\n  display: block;\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 2px;\r\n  background: #898989;\r\n  left: 0;\r\n  top: 65px;\r\n  margin-left: -2px;\r\n  z-index: 99;\n}\n.timeline li:last-child .time:before {\r\n  content: \"\";\r\n  display: block;\r\n  position: absolute;\r\n  width: 28px;\r\n  height: 28px;\r\n  top: 50px;\r\n  margin-bottom: -4px;\r\n  left: 50%;\r\n  margin-left: -15px;\r\n  border: 5px #4b6eca solid;\r\n  background: #fff;\r\n  border-radius: 100%;\r\n  background-size: 10px 10px;\r\n  z-index: 999;\n}\n.timeline li .desc {\r\n  color: #888;\r\n  padding-bottom: 50px;\r\n  font-size: 16px;\n}\n.uploader .el-upload {\r\n  border: 1px dashed #9db9fa;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 148px;\r\n  height: 148px;\r\n  line-height: 148px;\r\n  text-align: center;\n}\n.uploader .upimgitem {\r\n  width: 100%;\r\n  margin-top: 10px;\n}\n.uploaderthree .el-upload {\r\n  border: 1px dashed #9db9fa;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 148px;\r\n  height: 148px;\r\n  line-height: 148px;\r\n  text-align: center;\n}\n.uploaderthree .upimgitem {\r\n  width: 100%;\r\n  margin-top: 10px;\n}\n.dialog-danger .el-textarea__inner {\r\n  border: 1px #9db9fa solid;\r\n  color: #4b6eca;\r\n  height: 100px;\n}\n.dialog-danger .el-textarea {\r\n  width: 100% !important;\n}\n.dialog-danger .el-select {\r\n  width: 100%;\n}\n.dialog-danger .el-form-item__label {\r\n  width: 110px;\n}\n.dialog-danger .el-form-item__content {\r\n  margin-left: 110px;\n}\n.my-radio .el-radio {\r\n  margin-right: 15px !important;\n}\n.my-radio label{margin-bottom: 15px;\n}\n.el-image-viewer__canvas img {\r\n  width: auto !important;\r\n  height: auto !important;\n}\r\n", ""]);

// exports


/***/ }),

/***/ "h5Rs":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/views/security/index.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

/* harmony default export */ var security = ({
  data: function data() {
    var _this = this;

    return {
      pickerOptionsStart: {
        disabledDate: function disabledDate(time) {
          if (_this.searchForm.end_time) {
            return time.getTime() > new Date(_this.searchForm.end_time).getTime();
          }
        }
      },
      pickerOptionsEnd: {
        disabledDate: function disabledDate(time) {
          if (_this.searchForm.start_time) {
            return time.getTime() < new Date(_this.searchForm.start_time).getTime();
          }
        }
      },
      searchForm: {
        type: 1
      },
      uploadAction: this.hostURL + "/upload/uploadFile",
      dataList: [],
      dataListEmptyText: "无近七日内安全管理事件",
      companyList: [],
      trainList: [],
      dangerTypeList: [],
      dangerDetermineList: [],
      objSelectLists: [],
      formData: {},
      formRules: {
        depart_id: [{ required: true, message: "请选择公司", trigger: "change" }],
        admin_id: [{ required: true, message: "请选择人员", trigger: "change" }],
        title: [{
          required: true,
          message: "请输入安全事件标题2~30个字符",
          trigger: "blur"
        }, { min: 2, max: 30, message: "长度在2到30个字符", trigger: "blur" }, {
          pattern: /(^\S+).*(\S+$)/,
          message: "开始和结尾不能有空格",
          trigger: "blur"
        }],
        address: [{
          required: true,
          message: "请输入安全事件地址2~100个字符",
          trigger: "blur"
        }, { min: 2, max: 100, message: "长度在2到100个字符", trigger: "blur" }, {
          pattern: /\s\S+|S+\s|\S/,
          message: "内容不能全是空格",
          trigger: "blur"
        }],
        description: [{
          required: true,
          message: "请输入安全事件描述2~255个字符",
          trigger: "blur"
        }, { min: 2, max: 255, message: "长度在2到255个字符", trigger: "blur" }, {
          pattern: /\s\S+|S+\s|\S/,
          message: "内容不能全是空格",
          trigger: "blur"
        }]
      },
      dialogFormEvent: false,
      dialogImageUrl: "",
      dialogVisible: false,
      eventTitle: "",
      eventDesc: "",
      eventPictureList: [],
      eventPeopleList: [],
      diaDangerFormVisible: false,
      dangerIdValue: 0,
      dangerTypeValue: "",
      diaPeopleFormVisible: false,
      peopleData: {},
      assignersList: [],
      peopleRules: {
        user_id: [{ required: true, message: "请选择指派人员", trigger: "change" }],
        remark: [{
          min: 2,
          max: 200,
          message: "请输入备注描述长度在2到200个字符",
          trigger: "blur"
        }]
      }
    };
  },
  created: function created() {
    //alert(document.location.hostname);
    this.defaultDate();
    this.getCompanyLists();
    // this.getTrainList();
    // this.getDangerType();
    this.getDangerDetermine();
    this.getDataList();
  },

  methods: {
    defaultDate: function defaultDate() {
      var currentDate = new Date();
      var endTime = currentDate.setHours(23, 59, 59, 999);
      var starTime = new Date(currentDate.setDate(currentDate.getDate() - 7)).setHours(0, 0, 0, 999);
      this.$set(this.searchForm, "start_time", new Date(starTime));
      this.$set(this.searchForm, "end_time", new Date(endTime));
    },

    //====列表数据
    getDataList: function getDataList() {
      var _this2 = this;

      var page = this.page_cur;
      //let type = this.searchForm.type;
      // let danger_type = this.searchForm.danger_type;
      // let danger_determine = this.searchForm.danger_determine;
      // let loco_id = this.searchForm.loco_id;
      // let start_location = this.searchForm.start_location;
      // let end_location = this.searchForm.end_location;
      var start_time = this.searchForm.start_time;
      var end_time = this.searchForm.end_time;
      this.request({
        url: "/security/getSecurityPages",
        method: "get",
        params: {
          page: page,
          start_time: start_time,
          end_time: end_time
        }
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          _this2.dataList = data.data.data;
          _this2.page_cur = parseInt(data.data.current_page);
          _this2.pageTotal = data.data.total;
          _this2.page_size = data.data.per_page;
          _this2.page_total = data.data.last_page;
        }
      });
    },
    pageChange: function pageChange(value) {
      this.page_cur = value;
      this.getDataList();
    },
    pageToFirst: function pageToFirst() {
      this.pageChange(1);
    },
    pageToLast: function pageToLast() {
      this.page_cur = this.page_total;
      this.pageChange(this.page_total);
    },
    pageSearch: function pageSearch() {
      this.dataListEmptyText = "暂无数据";
      this.page_cur = 1;
      this.getDataList();
      this.goDetail(0);
    },
    resetSerach: function resetSerach() {
      this.searchForm.start_time = "";
      this.searchForm.end_time = "";
      this.page_cur = 1;
      this.getDataList();
      this.goDetail(0);
    },

    //================事件表单操作
    addDialogEvents: function addDialogEvents() {
      var _this3 = this;

      this.dialogFormEvent = true;
      this.$nextTick(function () {
        _this3.$refs["formRulesRef"].clearValidate();
      });
      var uploadImgs = document.getElementsByClassName("upimgitem");
      if (uploadImgs.length > 0) {
        this.$refs.uploadfive.clearFiles();
      }
      console.log("uploadImgs：" + uploadImgs.length);
    },

    //获取公司
    getCompanyLists: function getCompanyLists() {
      var _this4 = this;

      this.request({
        url: "/apply/getCompanyLists",
        method: "get"
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          _this4.companyList = data.data;
        }
      });
    },
    selectCompanyList: function selectCompanyList(val) {
      var _this5 = this;

      this.$set(this.formData, "admin_id", "");
      this.request({
        url: "/user/getUserByDepart",
        method: "get",
        params: { id: val, type: 1 }
      }).then(function (response) {
        var data = response.data;
        if (data.status == 1) {
          _this5.objSelectLists = data.data;
        }
      });
    },

    //获取机车
    getTrainList: function getTrainList() {
      var _this6 = this;

      this.request({
        url: "/dispatch/getLocomotiveLists",
        method: "get"
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          _this6.trainList = data.data;
        }
      });
    },

    //获取隐患类型
    getDangerType: function getDangerType() {
      var _this7 = this;

      this.request({
        url: "/security/getDangerType",
        method: "get"
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          _this7.dangerTypeList = data.data.data.reverse();
        }
      });
    },

    //获取隐患判定
    getDangerDetermine: function getDangerDetermine() {
      var _this8 = this;

      this.request({
        url: "/security/getDangerDetermine",
        method: "get"
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          _this8.dangerDetermineList = data.data.data.reverse();
        }
      });
    },

    //上传图片
    uploadExceed: function uploadExceed() {
      this.$message({
        type: "warning",
        message: "\u6700\u591A\u53EF\u4EE5\u4E0A\u4F205\u5F20\u56FE\u7247"
      });
    },
    uploadSuccess: function uploadSuccess(res, file) {
      // let result= URL.createObjectURL(file.raw);
      console.log("图上传成功", res);
      var upload_list_li = document.getElementsByClassName("el-upload-list")[0].children;
      if (res.data.url != "") {
        for (var i = 0; i < upload_list_li.length; i++) {
          var li_a = upload_list_li[i];
          var imgElement = document.createElement("img");
          imgElement.setAttribute("src", res.data.url);
          imgElement.setAttribute("class", "upimgitem");
          if (li_a.lastElementChild.nodeName !== "IMG") {
            li_a.appendChild(imgElement);
          }
        }
      }
    },
    uploadBefore: function uploadBefore(file) {
      var filename = file.name.substring(file.name.lastIndexOf(".") + 1);
      var extension = filename === "GIF" || filename === "gif" || filename === "jpeg" || filename === "jpg" || filename === "JPG" || filename === "png" || filename === "PNG";
      var isLtM = file.size / 1024 / 1024 < 2;
      if (!extension) {
        this.$message({
          message: "上传图片只能是 jpg  png  gif 格式!",
          type: "error"
        });
        return false; //必须加上return false; 才能阻止
      }
      if (!isLtM) {
        this.$message({
          message: "上传图片大小不能超过 2MB!",
          type: "error"
        });
        return false;
      }
      return extension || isLtM;
    },

    //保存
    addEvent: function addEvent() {
      var _this9 = this;

      this.$refs["formRulesRef"].validate(function (valid) {
        if (valid) {
          var data = _this9.formData;
          var img_urls = [];
          var uls = document.getElementsByClassName("el-upload-list");
          for (var i = 0; i < uls.length; i++) {
            var imgs = uls[i].getElementsByClassName("upimgitem");
            for (var j = 0; j < imgs.length; j++) {
              //img_urls[i][j] = imgs[j].src;
              img_urls.push({
                src: imgs[j].src
              });
            }
          }
          _this9.formData.file = img_urls;
          _this9.request({
            url: "/security/addSecurity",
            method: "post",
            data: data
          }).then(function (res) {
            var data = res.data;
            if (data.status == 1) {
              _this9.$message({
                showClose: true,
                message: "添加成功",
                type: "success"
              });
              _this9.formData = {};
              _this9.dialogFormEvent = false;
              _this9.getDataList();
            } else {
              _this9.$message({
                showClose: true,
                message: "添加失败",
                type: "error"
              });
            }
          });
        }
      });
    },
    goDetail: function goDetail(id) {
      var _this10 = this;

      this.request({
        url: "/security/getSecurityDetail",
        method: "get",
        params: { id: id }
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          if (id == 0) {
            _this10.eventTitle = "";
          } else {
            _this10.eventTitle = " 发起新事件：";
          }
          _this10.eventDesc = data.data.description;
          _this10.eventPictureList = data.data.file;
        }
      });
      this.request({
        url: "/security/getSecurtiyLogLists",
        method: "get",
        params: { sid: id }
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          _this10.eventPeopleList = data.data;
        }
      });
    },

    //查看
    goDetermine: function goDetermine(id) {
      this.diaDangerFormVisible = true;
      this.dangerIdValue = id;
    },
    setDetermineDialog: function setDetermineDialog() {
      var _this11 = this;

      var values = this.dangerTypeValue;
      if (values == "") {
        this.$message.error("请选择隐患类型");
        return false;
      }
      var id = this.dangerIdValue;
      var type = values;
      this.request({
        url: "/security/securityJudge",
        method: "post",
        data: { sid: id, type: type }
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          _this11.$message({
            showClose: true,
            message: "设置成功",
            type: "success"
          });
          _this11.diaDangerFormVisible = false;
          _this11.addPageShow = false;
          _this11.listPageShow = true;
          _this11.getDataList();
        } else {
          _this11.$message.error("设置失败，请稍后再试");
        }
      });
    },

    //===============人员指派
    //上传图片
    uploadThreeExceed: function uploadThreeExceed() {
      this.$message({
        type: "warning",
        message: "\u6700\u591A\u53EF\u4EE5\u4E0A\u4F203\u5F20\u56FE\u7247"
      });
    },
    uploadThreeSuccess: function uploadThreeSuccess(res, file) {
      console.log("图上传成功", res);
      var upload_list_li = document.getElementsByClassName("el-upload-list")[0].children;
      if (res.data.url != "") {
        for (var i = 0; i < upload_list_li.length; i++) {
          var li_a = upload_list_li[i];
          var imgElement = document.createElement("img");
          imgElement.setAttribute("src", res.data.url);
          imgElement.setAttribute("class", "upimgitems");
          if (li_a.lastElementChild.nodeName !== "IMG") {
            li_a.appendChild(imgElement);
          }
        }
      }
    },

    //获取人员
    getAssigners: function getAssigners() {
      var _this12 = this;

      this.request({
        url: "/security/getAssigners",
        method: "get"
      }).then(function (res) {
        var data = res.data;
        if (data.status == 1) {
          _this12.assignersList = data.data;
        }
      });
    },

    //指派
    goAssign: function goAssign(id) {
      this.dialogFormEvent = false;
      this.diaPeopleFormVisible = true;
      this.dangerIdValue = id;
      this.getAssigners();
      this.$set(this.peopleData, "user_id", "");
      this.$set(this.peopleData, "remark", "");
      var uploadImgs = document.getElementsByClassName("upimgitems");
      if (uploadImgs.length > 0) {
        this.$refs.uploadthree.clearFiles();
      }
    },
    saveAssignDialog: function saveAssignDialog() {
      var _this13 = this;

      this.$refs["peopleRulesRef"].validate(function (valid) {
        if (valid) {
          var data = _this13.peopleData;
          var user_id = _this13.peopleData.user_id;
          var sid = _this13.dangerIdValue;
          var img_urls = [];
          var uls = document.getElementsByClassName("el-upload-list");
          for (var i = 0; i < uls.length; i++) {
            var imgs = uls[i].getElementsByClassName("upimgitems");
            for (var j = 0; j < imgs.length; j++) {
              img_urls.push({
                src: imgs[j].src
              });
            }
          }
          console.log("img_urls：" + img_urls);
          _this13.request({
            url: "/security/assignPeople",
            method: "POST",
            header: { "Content-Type": "application/x-www-form-urlencoded" },
            data: { user_id: user_id, sid: sid, file: img_urls }
          }).then(function (res) {
            var data = res.data;
            if (data.status == 1) {
              _this13.$message({
                showClose: true,
                message: "添加成功",
                type: "success"
              });
              _this13.diaPeopleFormVisible = false;
              _this13.addPageShow = false;
              _this13.listPageShow = true;
              _this13.goDetail(_this13.dangerIdValue);
            } else {
              _this13.$message({
                showClose: true,
                message: "添加失败",
                type: "error"
              });
            }
          });
        }
      });
    },
    changeTime: function changeTime(time) {
      if (time !== null && time !== undefined && time !== "") {
        return "<span style='display:block'>" + time.substring(0, 10) + "</span><span style='display:block'>" + time.substring(time.length - 8) + "</span>";
      } else {
        return "";
      }
    }
    //

  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-980fe588","hasScoped":false,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/security/index.vue
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{"id":"security"}},[_c('div',{staticClass:"el-menu-top"},[_c('el-menu',{attrs:{"mode":"horizontal"}},[_c('li',{staticClass:"ptitle"},[_c('img',{attrs:{"src":__webpack_require__("k0DF")}}),_vm._v("安全管理\n      ")])])],1),_vm._v(" "),_c('div',{staticClass:"app-page"},[_c('div',{staticClass:"app-page-container"},[_c('div',{staticClass:"app-page-select"},[_c('el-form',{attrs:{"model":_vm.searchForm,"inline":true}},[_c('el-form-item',{staticClass:"form-add-item"},[_c('el-button',{attrs:{"size":"small","icon":"el-icon-plus","type":"primary"},on:{"click":_vm.addDialogEvents}},[_vm._v("添加事件")])],1),_vm._v(" "),_c('el-form-item',{staticStyle:{"display":"none"},attrs:{"label":"事件类型"}},[_c('el-select',{model:{value:(_vm.searchForm.type),callback:function ($$v) {_vm.$set(_vm.searchForm, "type", $$v)},expression:"searchForm.type"}},[_c('el-option',{attrs:{"label":"人员提交","value":1}}),_vm._v(" "),_c('el-option',{attrs:{"label":"机车提交","value":2}})],1)],1),_vm._v(" "),(_vm.searchForm.type==2)?_c('span',[_c('el-form-item',{attrs:{"label":"隐患类型"}},[_c('el-select',{model:{value:(_vm.searchForm.danger_type),callback:function ($$v) {_vm.$set(_vm.searchForm, "danger_type", $$v)},expression:"searchForm.danger_type"}},_vm._l((_vm.dangerTypeList),function(item){return _c('el-option',{key:item.id,attrs:{"label":item.name,"value":item.id}})}))],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"隐患判定"}},[_c('el-select',{model:{value:(_vm.searchForm.danger_determine),callback:function ($$v) {_vm.$set(_vm.searchForm, "danger_determine", $$v)},expression:"searchForm.danger_determine"}},_vm._l((this.dangerDetermineList),function(item){return _c('el-option',{key:item.id,attrs:{"label":item.name,"value":item.id}})}))],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"机车"}},[_c('el-select',{model:{value:(_vm.searchForm.loco_id),callback:function ($$v) {_vm.$set(_vm.searchForm, "loco_id", $$v)},expression:"searchForm.loco_id"}},_vm._l((this.trainList),function(item){return _c('el-option',{key:item.id,attrs:{"label":item.name,"value":item.id}})}))],1),_vm._v(" "),_c('el-form-item',{staticClass:"el-form-item-inline",attrs:{"label":"位置范围"}},[_c('el-input',{attrs:{"autocomplete":"off"},model:{value:(_vm.searchForm.start_location),callback:function ($$v) {_vm.$set(_vm.searchForm, "start_location", $$v)},expression:"searchForm.start_location"}}),_vm._v(" "),_c('b',[_vm._v("~")]),_vm._v(" "),_c('el-input',{attrs:{"autocomplete":"off"},model:{value:(_vm.searchForm.end_location),callback:function ($$v) {_vm.$set(_vm.searchForm, "end_location", $$v)},expression:"searchForm.end_location"}})],1)],1):_vm._e(),_vm._v(" "),_c('el-form-item',{attrs:{"label":"发现时间段"}},[_c('el-date-picker',{attrs:{"picker-options":_vm.pickerOptionsStart,"type":"datetime","format":"yyyy-MM-dd HH:mm","placeholder":"开始时间","clearable":""},model:{value:(_vm.searchForm.start_time),callback:function ($$v) {_vm.$set(_vm.searchForm, "start_time", $$v)},expression:"searchForm.start_time"}})],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"-"}},[_c('el-date-picker',{attrs:{"picker-options":_vm.pickerOptionsEnd,"type":"datetime","format":"yyyy-MM-dd HH:mm","placeholder":"结束时间","clearable":""},model:{value:(_vm.searchForm.end_time),callback:function ($$v) {_vm.$set(_vm.searchForm, "end_time", $$v)},expression:"searchForm.end_time"}})],1),_vm._v(" "),_c('el-form-item',{staticClass:"form-so"},[_c('label',{staticClass:"el-form-item__label"}),_vm._v(" "),_c('el-button',{attrs:{"size":"small","icon":"el-icon-search","type":"primary"},on:{"click":_vm.pageSearch}},[_vm._v("查询")]),_vm._v(" "),_c('el-button',{attrs:{"size":"small","plain":""},on:{"click":_vm.resetSerach}},[_vm._v("重置")])],1)],1)],1),_vm._v(" "),_c('div',{staticClass:"app-table"},[_c('el-table',{attrs:{"data":_vm.dataList,"empty-text":_vm.dataListEmptyText}},[_c('el-table-column',{attrs:{"prop":"id","label":"序号","width":"100"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"company","label":"公司"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"title","label":"事件名称"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"address","label":"事件地址","show-overflow-tooltip":""}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"type","label":"事件类型"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [_vm._v(_vm._s(scope.row.type==1?"人员提交":"机车提交"))]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"danger_determine_name","label":"隐患判定"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [(scope.row.danger_determine_name=='')?_c('span',[_vm._v("未判定")]):_c('span',[_vm._v(_vm._s(scope.row.danger_determine_name))])]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"status","label":"状态"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [(scope.row.status==1)?_c('span',[_vm._v("新事件")]):(scope.row.status==2)?_c('span',[_vm._v("处理中")]):_c('span',[_vm._v("已完成")])]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"label":"当前情况","prop":"current_status"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"admin","label":"提交者"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"create_time","label":"发布时间"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [_c('p',{domProps:{"innerHTML":_vm._s(_vm.changeTime(scope.row.create_time))}})]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"label":"操作","width":"200"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [_c('div',{staticClass:"app-operation"},[_c('el-button',{staticClass:"btn-blue",attrs:{"size":"mini"},on:{"click":function($event){_vm.goDetail(scope.row.id)}}},[_vm._v("查看")]),_vm._v(" "),_c('el-button',{staticClass:"btn-blue",attrs:{"size":"mini"},on:{"click":function($event){_vm.goAssign(scope.row.id)}}},[_vm._v("指派")]),_vm._v(" "),_c('el-button',{staticClass:"btn-red",attrs:{"size":"mini"},on:{"click":function($event){_vm.goDetermine(scope.row.id)}}},[_vm._v("隐患判定")])],1)]}}])})],1),_vm._v(" "),_c('div',{staticClass:"app-pagination"},[(_vm.dataList.length !== 0)?_c('el-pagination',{staticClass:"pagination",attrs:{"layout":"slot,prev, pager, next,slot,total","page-size":this.page_size,"current-page":this.page_cur,"total":this.pageTotal,"prev-text":"上一页","next-text":"下一页"},on:{"current-change":_vm.pageChange}},[_c('button',{staticClass:"btn-first",attrs:{"type":"button"},on:{"click":_vm.pageToFirst}},[_c('span',[_vm._v("首页")])]),_vm._v(" "),_c('button',{staticClass:"btn-last",attrs:{"type":"button"},on:{"click":_vm.pageToLast}},[_c('span',[_vm._v("尾页")])])]):_vm._e()],1)],1)]),_vm._v(" "),_c('div',{staticClass:"listpagedetail"},[_c('div',{staticClass:"detailleft"},[_c('div',{staticClass:"security-title"},[_vm._v("施工问题详情")]),_vm._v(" "),_c('div',{staticClass:"app-page-container"},[_c('div',{staticClass:"steps-info"},[_c('div',{staticStyle:{"overflow":"hidden"}},[_c('h3',[_vm._v(_vm._s(_vm.eventTitle))]),_vm._v("\n              "+_vm._s(_vm.eventDesc)+"\n            ")]),_vm._v(" "),_c('div',{staticClass:"imgs"},_vm._l((_vm.eventPictureList),function(item){return _c('el-image',{key:item.id,attrs:{"preview-src-list":[item.src],"src":item.src}})}))])])]),_vm._v(" "),_c('div',{staticClass:"detailright"},[_c('div',{staticClass:"security-title"},[_vm._v("处理进度")]),_vm._v(" "),_c('div',{staticClass:"app-page-container"},[_c('div',{staticClass:"steps-section"},[_c('ul',{staticClass:"timeline"},_vm._l((_vm.eventPeopleList),function(item){return _c('li',{key:item.id},[_c('div',{staticClass:"desc"},[_vm._v(_vm._s(item.description))]),_vm._v(" "),_c('div',{staticClass:"time"},[_vm._v("\n                  "+_vm._s(item.user_name)+"\n                  "),_c('p',[_vm._v(_vm._s(item.create_time))])])])}))])])])]),_vm._v(" "),_c('el-dialog',{staticClass:"dialog-dangers",attrs:{"width":"900px","close-on-click-modal":false,"title":"添加安全事件","visible":_vm.dialogFormEvent},on:{"update:visible":function($event){_vm.dialogFormEvent=$event}}},[_c('div',{staticClass:"formbox"},[_c('el-form',{ref:"formRulesRef",staticClass:"el-form-custom",attrs:{"label-width":"120px","label-position":"right","model":_vm.formData,"rules":_vm.formRules}},[_c('el-form-item',{attrs:{"label":"添加事件公司：","prop":"depart_id"}},[_c('el-select',{attrs:{"placeholder":"请选择公司"},on:{"change":function($event){_vm.selectCompanyList($event)}},model:{value:(_vm.formData.depart_id),callback:function ($$v) {_vm.$set(_vm.formData, "depart_id", $$v)},expression:"formData.depart_id"}},_vm._l((_vm.companyList),function(item){return _c('el-option',{key:item.id,attrs:{"label":item.name,"value":item.id}})}))],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"人员：","prop":"admin_id"}},[_c('el-select',{attrs:{"placeholder":"请选择人员："},model:{value:(_vm.formData.admin_id),callback:function ($$v) {_vm.$set(_vm.formData, "admin_id", $$v)},expression:"formData.admin_id"}},_vm._l((this.objSelectLists),function(item){return _c('el-option',{key:item.id,attrs:{"label":item.name,"value":item.id}})}))],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"安全事件标题：","prop":"title"}},[_c('el-input',{model:{value:(_vm.formData.title),callback:function ($$v) {_vm.$set(_vm.formData, "title", $$v)},expression:"formData.title"}})],1),_vm._v(" "),_c('el-form-item',{staticClass:"textarea1",attrs:{"label":"安全事件地址：","prop":"address"}},[_c('el-input',{attrs:{"type":"textarea"},model:{value:(_vm.formData.address),callback:function ($$v) {_vm.$set(_vm.formData, "address", $$v)},expression:"formData.address"}})],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"安全事件描述：","prop":"description"}},[_c('el-input',{attrs:{"type":"textarea"},model:{value:(_vm.formData.description),callback:function ($$v) {_vm.$set(_vm.formData, "description", $$v)},expression:"formData.description"}})],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"相关图片："}},[_c('p',{staticStyle:{"color":"#3655a5"}},[_vm._v("最多可以上传5张图片，支持格式 jpg png gif，大小不能超过 2MB。")]),_vm._v(" "),_c('el-upload',{ref:"uploadfive",staticClass:"uploader el-upload-list--picture-card",attrs:{"action":_vm.uploadAction,"limit":5,"list-type":"picture-card","auto-upload":true,"on-exceed":_vm.uploadExceed,"before-upload":_vm.uploadBefore,"on-success":_vm.uploadSuccess}},[_c('i',{staticClass:"el-icon-plus"})]),_vm._v(" "),_c('el-dialog',{attrs:{"visible":_vm.dialogVisible},on:{"update:visible":function($event){_vm.dialogVisible=$event}}},[_c('img',{attrs:{"width":"100%","src":_vm.dialogImageUrl,"alt":""}})])],1)],1)],1),_vm._v(" "),_c('div',{staticClass:"dialog-footer",attrs:{"slot":"footer"},slot:"footer"},[_c('el-button',{on:{"click":function($event){_vm.dialogFormEvent = false}}},[_vm._v("关闭")]),_vm._v(" "),_c('el-button',{attrs:{"type":"primary"},on:{"click":function($event){_vm.addEvent()}}},[_vm._v("确定上传信息")])],1)]),_vm._v(" "),_c('el-dialog',{staticClass:"dialog-dangers",attrs:{"width":"480px","close-on-click-modal":false,"title":"隐患类型设置","visible":_vm.diaDangerFormVisible},on:{"update:visible":function($event){_vm.diaDangerFormVisible=$event}}},[_c('el-form',{staticClass:"el-form-custom"},[_c('el-form-item',[_c('el-radio-group',{staticClass:"my-radio",model:{value:(_vm.dangerTypeValue),callback:function ($$v) {_vm.dangerTypeValue=$$v},expression:"dangerTypeValue"}},_vm._l((_vm.dangerDetermineList),function(item){return _c('el-radio',{key:item.id,attrs:{"label":item.id}},[_vm._v(_vm._s(item.name))])}))],1),_vm._v(" "),_c('div',{staticClass:"blank"})],1),_vm._v(" "),_c('div',{staticClass:"dialog-footer",attrs:{"slot":"footer"},slot:"footer"},[_c('el-button',{on:{"click":function($event){_vm.diaDangerFormVisible = false}}},[_vm._v("关闭")]),_vm._v(" "),_c('el-button',{attrs:{"type":"primary"},on:{"click":function($event){_vm.setDetermineDialog()}}},[_vm._v("确定")])],1)],1),_vm._v(" "),_c('el-dialog',{staticClass:"dialog-danger",attrs:{"width":"700px","close-on-click-modal":false,"title":"指派人员","visible":_vm.diaPeopleFormVisible},on:{"update:visible":function($event){_vm.diaPeopleFormVisible=$event}}},[_c('el-form',{ref:"peopleRulesRef",staticClass:"el-form-custom",attrs:{"model":_vm.peopleData,"rules":_vm.peopleRules}},[_c('el-form-item',{attrs:{"label":"指派人员：","prop":"user_id"}},[_c('el-select',{model:{value:(_vm.peopleData.user_id),callback:function ($$v) {_vm.$set(_vm.peopleData, "user_id", $$v)},expression:"peopleData.user_id"}},_vm._l((this.assignersList),function(item){return _c('el-option',{key:item.id,attrs:{"label":item.name,"value":item.id}})}))],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"相关图片："}},[_c('p',{staticStyle:{"color":"#3655a5"}},[_vm._v("最多可以上传3张图片，支持格式 jpg png gif，大小不能超过 2MB。")]),_vm._v(" "),_c('el-upload',{ref:"uploadthree",staticClass:"uploaderthree el-upload-list--picture-card",attrs:{"action":_vm.uploadAction,"limit":3,"list-type":"picture-card","auto-upload":true,"before-upload":_vm.uploadBefore,"on-exceed":_vm.uploadThreeExceed,"on-success":_vm.uploadThreeSuccess}},[_c('i',{staticClass:"el-icon-plus"})]),_vm._v(" "),_c('el-dialog',{attrs:{"visible":_vm.dialogVisible},on:{"update:visible":function($event){_vm.dialogVisible=$event}}},[_c('img',{attrs:{"width":"100%","src":_vm.dialogImageUrl,"alt":""}})])],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"备注描述：","prop":"remark"}},[_c('el-input',{attrs:{"type":"textarea"},model:{value:(_vm.peopleData.remark),callback:function ($$v) {_vm.$set(_vm.peopleData, "remark", $$v)},expression:"peopleData.remark"}})],1),_vm._v(" "),_c('div',{staticClass:"blank"})],1),_vm._v(" "),_c('div',{staticClass:"dialog-footer",attrs:{"slot":"footer"},slot:"footer"},[_c('el-button',{on:{"click":function($event){_vm.diaPeopleFormVisible = false}}},[_vm._v("关闭")]),_vm._v(" "),_c('el-button',{attrs:{"type":"primary"},on:{"click":function($event){_vm.saveAssignDialog()}}},[_vm._v("确定")])],1)],1)],1)])}
var staticRenderFns = []
var esExports = { render: render, staticRenderFns: staticRenderFns }
/* harmony default export */ var views_security = (esExports);
// CONCATENATED MODULE: ./src/views/security/index.vue
function injectStyle (ssrContext) {
  __webpack_require__("yzHY")
}
var normalizeComponent = __webpack_require__("VU/8")
/* script */

/* template */

/* template functional */
var __vue_template_functional__ = false
/* styles */
var __vue_styles__ = injectStyle
/* scopeId */
var __vue_scopeId__ = null
/* moduleIdentifier (server only) */
var __vue_module_identifier__ = null
var Component = normalizeComponent(
  security,
  views_security,
  __vue_template_functional__,
  __vue_styles__,
  __vue_scopeId__,
  __vue_module_identifier__
)

/* harmony default export */ var src_views_security = __webpack_exports__["default"] = (Component.exports);


/***/ }),

/***/ "yzHY":
/***/ (function(module, exports, __webpack_require__) {

// style-loader: Adds some css to the DOM by adding a <style> tag

// load the styles
var content = __webpack_require__("0QOC");
if(typeof content === 'string') content = [[module.i, content, '']];
if(content.locals) module.exports = content.locals;
// add the styles to the DOM
var update = __webpack_require__("rjj0")("ecce7228", content, true);

/***/ })

});